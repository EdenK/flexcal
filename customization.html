<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Flexcal Customization</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" href="stylesheets/prism-dw.css" />
 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
	<script src="https://cdn.rawgit.com/dwachss/prism/gh-pages/prism.js"></script>
    <script src="javascripts/prism.linenumber.js"></script>
	<script src="loadflexcal.js"></script>
 </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Flexcal</h1>
        <p>jQuery UI datepicker</p>

        <p class="view"><a href="https://github.com/dwachss/flexcal">View the Project on GitHub <small>dwachss/flexcal</small></a></p>


        <ul>
          <li><a href="https://github.com/dwachss/flexcal/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/dwachss/flexcal/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/dwachss/flexcal">View On <strong>GitHub</strong></a></li>
        </ul>
		<nav>
		</nav>
      </header>
      <section>
<h1>Customizing Flexcal</h1>
<p>I've had some requests for changing the way <code>flexcal</code> works, beyond what is available from the options. One is for a "Today" button, which is straightforward:</p>
<input id=1 />
<pre><code class="language-javascript demo">$('#1').flexcal({position: 'bl'}); // create the calendar
var today = $('&lt;button&gt;Today&lt;/button&gt;').click(function(){ // create the button
	$('#1').flexcal('commit', new Date).flexcal('hide');
});
$('#1').flexcal('option', 'box').find('.ui-flexcal-buttonpane').append(today); // add it to the buttons
</code></pre>

<p><code>flexcal</code> uses my <a href=http://github.bililite.com/extending-widgets.html>extendable widget code</a>, so it is easy to extend, especially with some understanding of the source code. The most useful method to extend is <code class=language-javascript>_adjustHTML(cal)</code>. It is called after generating the calendar; <code>cal</code> is a <code class=language-html>&lt;div&gt;</code> with class <code>ui-flexcal-pane</code> that contains the table that represents the calendar. So changing the month and year indicators to drop-down menus is a little complex since the menus need to be specific for the <a href=localization.html>localization</a>. But the following works:</p>
<input id=2 />
<pre><code class="language-javascript demo">
function monthMenu (targetDate, l10n){
	var c = l10n.calendar, targetYear = c(targetDate).y;
	function option (d){
		return $('&lt;option&gt;').val(d.toString()).text(l10n.monthNames[c(d).m]);
	}
	var ret = $('&lt;select&gt');
	ret.append(option(targetDate).attr('selected', 'selected'));
	for (var d=c(targetDate).prev; c(d).y === targetYear; d = c(d).prev){ // go through all the previous months of the year 
		ret.prepend(option(d));
	}
	for (var d=c(targetDate).next; c(d).y === targetYear; d = c(d).next){ // go through all the next months of the year
		ret.append(option(d));
	}
	return ret;
};

function yearMenu (targetDate, l10n, n){
	var c = l10n.calendar;
	function option (d){
		return $('&lt;option&gt;').val(d.toString()).text(l10n.years(c(d).y));
	}
	var ret = $('&lt;select&gt');
	ret.append(option(targetDate).attr('selected', 'selected'));
	for (var i = 0, d=c(targetDate).prevYear; i < n; ++i, d=c(d).prevYear){ 
		ret.prepend(option(d));
	}
	for (var i = 0, d=c(targetDate).nextYear; i < n; ++i, d=c(d).nextYear){ 
		ret.append(option(d));
	}
	return ret;
};

$('#2').flexcal({calendars: ['en', 'he-jewish'], position: 'bl', 'class': 'multicalendar'}); // create the calendar
$('#2').flexcal('after', '_adjustHTML', function (cal){ // extend the _adjustHTML method
	cal.find('.ui-datepicker-month').html(monthMenu(this.option('current'), this.option('l10n')));
	cal.find('.ui-datepicker-year').html(yearMenu(this.option('current'), this.option('l10n'), 5));
	var self = this;
	cal.find('select').on('change', function(){
		self.option('current', new Date($(this).val()));
	}); 
});
</code></pre>

<p>As described in the <a href=http://github.bililite.com/extending-widgets.html>Extending Widgets tutorial</a>, this creates a single instance of <code>flexcal</code> with the drop-down menus. You could subclass <code>flexcal</code> to do the same thing but allow creating multiple instances:</p>
<input id=3 />
<pre><code class="language-javascript demo">
$.widget ('bililite.dropdownflexcal', $.bililite.flexcal, {
	_adjustHTML: function(cal){
		this._super(cal);
		cal.find('.ui-datepicker-month').html(monthMenu(this.option('current'), this.option('l10n')));
		cal.find('.ui-datepicker-year').html(yearMenu(this.option('current'), this.option('l10n'), this.option('yearRange')));
		var self = this;
		cal.find('select').on('change', function(){
			self.option('current', new Date($(this).val()));
		}); 		
	},
	options: {yearRange: 5}
});

$('#3').dropdownflexcal({calendars: ['en', 'he-jewish'], position: 'bl', 'class': 'multicalendar'});
</code></pre>
      </section>
      <footer>
		<p>Comments? Questions? Create an <a href=https://github.com/dwachss/flexcal/issues>issue</a>!</p>
		<p><small><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"></a> This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 License</a>.</small></p>
        <p><small>Hosted on GitHub Pages&mdash;Theme Based on Minimalist by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

  </body>
</html>